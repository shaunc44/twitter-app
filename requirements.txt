**** MySQL Code & Tables ****

-- ---
-- Globals
-- ---

-- SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";
-- SET FOREIGN_KEY_CHECKS=0;

-- ---
-- Table 'users'
-- 
-- ---


***************************************************************************
*************************   SET UP SQL TABLES   ***************************
***************************************************************************

DROP TABLE IF EXISTS `twitter`.`users`;
		
CREATE TABLE `twitter`.`users` (
  `user_id` BIGINT AUTO_INCREMENT,
  `username` VARCHAR(25) NULL,
  PRIMARY KEY (`user_id`)
);

-- ---
-- Table 'posts'
-- 
-- ---

DROP TABLE IF EXISTS `twitter`.`posts`;
		
CREATE TABLE `twitter`.`posts` (
  `post_id` BIGINT AUTO_INCREMENT,
  `user_id` BIGINT,
  `date` DATE NULL,
  `title` VARCHAR(50) NULL DEFAULT NULL,
  `text` VARCHAR(100) NULL DEFAULT NULL,
  PRIMARY KEY (`post_id`)
);

-- ---
-- Foreign Keys 
-- ---

ALTER TABLE `posts` ADD FOREIGN KEY (user_id) REFERENCES `users` (`user_id`);

-- ---
-- Table Properties
-- ---

-- ALTER TABLE `users` ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;
-- ALTER TABLE `posts` ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

-- ---
-- Test Data
-- ---

-- INSERT INTO `users` (`user_id`,`username`) VALUES
-- ('','');
-- INSERT INTO `posts` (`post_id`,`user_id`,`date`,`title`,`text`) VALUES
-- ('','','','','');


***************************************************************************
**********  STORED PROCEDURE TO ADD/CHECK USERNAME TO DATABASE  ***********
***************************************************************************

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_createUser`(
    IN p_username VARCHAR(25)
)
BEGIN
    if ( select exists (select 1 from users where username = p_username) ) THEN
        select 'Username Exists !!';
    ELSE
        insert into users
        (
            username
        )
        values
        (
            p_username
        );

    END IF;
END$$
DELIMITER ;


***************************************************************************
***************  STORED PROCEDURE TO ADD POST TO DATABASE  ****************
***************************************************************************

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_createPost`(
    IN p_date DATE,
    IN p_title VARCHAR(50),
    IN p_text VARCHAR(100)
)
BEGIN
    insert into posts
    (
        date,
        title,
        text
    )
    values
    (
        NOW(),
        p_title,
        p_text
    );

END$$
DELIMITER ;


